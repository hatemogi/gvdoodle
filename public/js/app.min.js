(function(){var a;a=angular.module("gvdoodle",["ui.bootstrap"]),a.controller("EditorCtrl",["$scope","$http","$sce","$modal",function(a,b,c,d){var e,f,g,h;return h=this,g=function(){return h.isLoading=!1,h.showPreview=!1,h.gvChanged=!1,h.runSuccess=!1,h.flash=sessionStorage.getItem("flash"),sessionStorage.removeItem("flash")},g(),h.changed=function(){return this.gvChanged||this.ranEngine!==this.engine},h.showPublishButton=function(){return(this.changed()||"NEWT1"===h.id)&&this.runSuccess&&!this.isLoading},window.editor=e=ace.edit("editor"),e.setTheme("ace/theme/tomorrow"),e.getSession().setMode("ace/mode/dot"),e.focus(),e.on("change",function(){var b;if(h.loadedValue)return b=h.gvChanged,h.gvChanged=e.getValue()!==h.loadedValue,b!==h.gvChanged?(h.runSuccess=!1,a.$apply()):void 0}),this.engine="dot",this.preview="preview.svg",this.engines=["dot","neato","fdp","sfdp","twopi","circo"],f=function(b,d){return a.svg=c.trustAsHtml(b),h.showPreview=!0,h.isLoading=!1,h.runSuccess=!!b.match(/<svg/),console.log(["success",b,d])},this.loadSaved=function(a){return b.get("/"+a+".svg").success(f)},this.run=function(){return h.isLoading=!0,h.ranEngine=h.engine,h.flash=null,b.post("/preview",{text:e.getValue(),engine:h.engine}).success(f).error(function(a){return console.log(["error",a])})},this.publishModal=function(){var b;return h.changed()?(b=d.open({scope:a,templateUrl:"template/publish"}),b.result.then(function(){return h.publish()})):void 0},this.publish=function(){return console.log("publish called"),h.isLoading=!0,b.post("/publish",{text:e.getValue(),engine:h.engine}).success(function(a){return sessionStorage.setItem("flash","Published!"),window.location.href="/"+a.gvid}).error(function(a){return console.log(["publish error",a])})},this.img_load=function(a){return console.dir(a)},this.load=function(a){return h.id=a,b.get("/"+a+".gv").success(function(a){return e.setValue(a),e.clearSelection(),h.loadedValue=a}),b.get("/"+a+".meta").success(function(a,b){return a&&a.engine&&(h.engine=h.ranEngine=a.engine),b}),h.svg_url="/"+a+".svg",h.showPreview=!1,a},this}]),a.directive("resizable",function(){return{link:function(a,b){return b.bind("load",function(){})}}})}).call(this);
//# sourceMappingURL=app.min.js.map